"use strict";let xPos_mp1,yPos_mp1,xPos_ln1,yPos_ln1,loading=[],geojson_nb={},geojson_wd={},geojson_mp1={},ln1Data=[];function positions(){xPos_mp1=$("#mp1").offset().left,yPos_mp1=$("#mp1").offset().top,xPos_ln1=$("#ln1").offset().left,yPos_ln1=$("#ln1").offset().top}!function(){const t=fetch("https://data.eindhoven.nl/api/records/1.0/search/?dataset=buurten&rows=116&facet=buurtcode&facet=buurtnaam&facet=wijkcode&facet=wijknaam").then(t=>t.json()),e=fetch("https://data.eindhoven.nl/api/records/1.0/search/?dataset=wijken&rows=20&facet=wijkcode&facet=wijknaam").then(t=>t.json()),s=fetch("https://raw.githubusercontent.com/tue-vll/data/master/Sport2017.json").then(t=>t.json()),a=fetch("https://raw.githubusercontent.com/tue-vll/data/master/Sport2006-2017_ward.json").then(t=>t.json());Promise.all([t,e,s,a]).then(t=>{let e=t[0].records,s=t[1].records,a=t[2],o=t[3],n=e.length,r={type:"FeatureCollection",features:[]};for(let t=0;t<n;t++){let s={type:"Feature",geometry:{type:"Polygon",coordinates:e[t].fields.geo_shape.coordinates},properties:{neighborhood:e[t].fields.buurtnaam}};r.features.push(s)}let l=[];for(let t=0;t<r.features.length;t++){let e=r.features[t].properties;e=e.neighborhood.replace(", ",",");const s=a.filter(t=>t.Buurten==e);l.push(s[0])}for(let t=0;t<r.features.length;t++)r.features[t].properties.sports=l[t]["doet aan sport 2017"];let i=s.length;geojson_wd.type="FeatureCollection",geojson_wd.features=[];for(let t=0;t<i;t++){let e={type:"Feature",geometry:{type:"Polygon",coordinates:s[t].fields.geo_shape.coordinates},properties:{ward:s[t].fields.wijknaam.slice(5)}};geojson_wd.features.push(e)}const p=()=>{function t(t){var e=d3.select(t.node().parentNode),s=parseInt(t.style("width")),a=parseInt(t.style("height")),o=s/a;function n(){var s=parseInt(e.style("width"));t.attr("width",s),t.attr("height",Math.round(s/o))}t.attr("viewBox","0 0 "+s+" "+a).attr("perserveAspectRatio","xMinYMid").call(n),d3.select(window).on("resize."+e.attr("id"),n)}!function(){let t=new L.Map("mp1").setView([51.45,5.45],12);L.esri.basemapLayer("Gray").addTo(t),function(){let e=d3.geoTransform({point:function(e,s){let a=t.latLngToLayerPoint(new L.LatLng(s,e));this.stream.point(a.x,a.y)}}),s=d3.geoPath().projection(e),a=d3.select(t.getPanes().overlayPane).append("svg"),o=a.append("g").attr("class","leaflet-zoom-hide"),n=o.selectAll("path").data(r.features).enter().append("path");function l(){let t=s.bounds(r),e=t[0],l=t[1];a.attr("width",l[0]-e[0]).attr("height",l[1]-e[1]).style("left",e[0]+"px").style("top",e[1]+"px"),o.attr("transform","translate("+-e[0]+","+-e[1]+")"),n.attr("d",s).style("stroke","rgb(187,187,187)").style("stroke-width","1px").style("fill",t=>t.properties.sports>=70&t.properties.sports<80?"rgb(215,48,31)":t.properties.sports>=60&t.properties.sports<70?"rgb(252,141,89)":t.properties.sports>=50&t.properties.sports<60?"rgb(253,204,138)":t.properties.sports>=40&t.properties.sports<50?"rgb(254,240,217)":"rgb(212,212,212)").attr("class","pointer-release").style("cursor","pointer").on("mouseover",function(t){let e;d3.select(this).transition().style("opacity",.5).duration(200),e=null!==t.properties.sports?'<span class="sp-tooltip_neighbor">'+t.properties.neighborhood+'</span><span "sp-tooltip_value">'+t.properties.sports+"%</span>":'<span class="sp-tooltip_neighbor">'+t.properties.neighborhood+'</span><span "sp-tooltip_value">No Data</span>',$("#mp1-tooltip").html(e).attr("aria-hidden","false").attr("width","auto").css("left",d3.mouse(this)[0]+10+"px").css("top",d3.mouse(this)[1]-50+"px")}).on("mouseout",function(){d3.select(this).transition().style("opacity",1).duration(200),$("#mp1-tooltip").attr("aria-hidden","true")}),$("#mp1-loader").attr("aria-hidden","true")}t.on("moveend",l),l()}()}(),function(){let e=Object.keys(o[0]).length,s=[];for(let t=0;t<o.length;t++){let a={values:[]};for(let s=0;s<e-1;s++){let e=null!==o[t][2006]&&0!==o[t][2006],n=null!==o[t][2007]&&0!==o[t][2007],r=null!==o[t][2008]&&0!==o[t][2008],l=null!==o[t][2009]&&0!==o[t][2009],i=null!==o[t][2010]&&0!==o[t][2010],p=null!==o[t][2011]&&0!==o[t][2011],d=null!==o[t][2012]&&0!==o[t][2012],c=null!==o[t][2013]&&0!==o[t][2013],u=null!==o[t][2014]&&0!==o[t][2014],h=null!==o[t][2015]&&0!==o[t][2015],f=null!==o[t][2016]&&0!==o[t][2016],g=null!==o[t][2017]&&0!==o[t][2017];e&&n&&r&&l&&i&&p&&d&&c&&u&&h&&f&&g&&(a.name="",a.name=o[t].Wijken,a.values[s]={year:Object.keys(o[t])[s],percent:o[t][Object.keys(o[t])[s]]})}void 0!==a.name&&s.push(a)}console.log(s),function(){let e=s,a=30,o=26,n=80,r=40,l=parseInt(d3.select("#ln1").style("width"))-r-o,i=parseInt(d3.select("#ln1").style("height"))-a-n,p=parseInt(d3.select("#ln1").style("width")),d=parseInt(d3.select("#ln1").style("height"))-40,c=d3.timeParse("%Y");e.forEach(t=>{t.values.forEach(t=>{t.year=c(t.year),t.percent=+t.percent})});let u=d3.scaleTime().range([0,l]),h=d3.scaleLinear().range([i,0]);u.domain(d3.extent(e[0].values,function(t){return t.year})),h.domain([30,90]);let f=d3.axisBottom(u),g=d3.axisLeft(h).ticks(7).tickSize(4),m=d3.axisLeft().tickFormat("").tickSize(-l).scale(h),y=d3.select("#ln1").append("svg").attr("class",()=>{if("Apple Computer, Inc."==navigator.vendor)return"topMargin"}).attr("height",d).attr("width",p).style("cursor","pointer").on("mouseenter",()=>{$(".ln1-group").addClass("in-active")}).on("mouseleave",()=>{$(".ln1-group").removeClass("in-active")}).call(t).attr("transform","translate(0,40)").append("g").attr("width",l).attr("height",i).attr("transform","translate("+r+","+a+")");y.append("g").attr("class","grid").call(m);let v=d3.line().x(t=>u(t.year)).y(t=>h(t.percent));y.append("g").attr("class","ln1lines").selectAll(".ln1line-group").data(e).enter().append("g").attr("class","ln1-group").append("path").attr("class","line").attr("d",t=>v(t.values)).on("mouseover",function(t){this.parentNode.appendChild(this),d3.select(this).classed("active",!0)}).on("mousemove",function(t){let e='<span class="ln1-tooltip_neighbor">'+t.name+"</span>";$("#ln1-tooltip").html(e).attr("aria-hidden",!1).attr("width","auto").attr("height","100px").css("left",d3.event.pageX-xPos_ln1+"px").css("top",d3.event.pageY-yPos_ln1-40+"px")}).on("mouseout",function(){d3.select(this).classed("active",!1),$("#ln1-tooltip").attr("aria-hidden",!0)}),y.append("g").attr("class","ln1-xAxis").attr("transform","translate(0,"+i+")").call(f),y.append("g").attr("class","ln1-yAxis").call(g).call(t=>t.select(".domain").remove()),y.append("text").attr("y",-20).attr("x",0).attr("dy","1em").style("text-anchor","middle").text("percent").style("font-size","12px").style("font-weight","bold"),$("#ln1-loader").attr("aria-hidden",!0)}()}()};$(document).ready(()=>{p()})})}();